apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: loki
  namespace: default
spec:
  interval: 1m
  chart:
    spec:
      chart: loki-stack
      version: "2.3.1"
      sourceRef:
        kind: HelmRepository
        name: grafana-charts
        namespace: flux-system
      interval: 1m
  values:
    loki:
      config:
        # schema_config:
        #   configs:
        #     - from: 2021-05-11
        #       store: boltdb-shipper
        #       object_store: s3
        #       schema: v11
        #       index:
        #         prefix: loki_index_
        #         period: 24h
        storage_config:
          aws:
            s3:
            valueFrom:
              secretKeyRef:
                name: iam-loki-s3
                key: S3_URL
            # region: us-west-2
          # boltdb_shipper:
          #   shared_store: aws
          #   active_index_directory: /var/loki/index
          #   cache_location: /var/loki/cache
          #   cache_ttl: 168h
          # filesystem:
          #   directory: /var/loki/chunks
    grafana:
      enabled: true
      sidecar:
        datasources:
          enabled: true
      image:
        tag: latest
      grafana.ini:
        users:
          default_theme: light
